# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
  branches:
    include:
      - master

pr: none

pool:
  vmImage: 'windows-2019'

steps:
- task: DotNetCoreCLI@2
  displayName: Test
  inputs:
    command: test
    projects: '$(Parameters.TestProjects)'
    arguments: '--configuration $(BuildConfiguration)'

- powershell: |

  $myHashValue = (Get-FileHash -Algorithm SHA256 "TestScript.ps1").Hash

  Write-Host "##vso[task.setvariable variable=ScriptFileHash]$myHashValue"

  displayname: "Setting file hash"

- task: GitHubRelease@0
  displayName: 'Edit GitHub Release'
  inputs:
    gitHubConnection: github.com_dpaulson45
    repositoryName: dpaulson45/TestRepos
    action: edit
    tag: v1.0.5
    releaseNotesSource: 'input'
    releaseNotes: "SHA256: $(ScriptFileHash)
    
    How to Verify Hash Value: https://github.com/dpaulson45/HealthChecker/wiki/How-to-Verify-Hash-Value"
    addChangeLog: true
    assets: |
      .\Test-Script\TestScript.ps1
      .\Test-Script\NewTestScript.ps1